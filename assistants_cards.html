<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ</title>
<style>
:root {
    --blue-royal:#4a6fa5;
    --gold:#ffc107;
    --green-success:#4caf50;
    --dark-bg:#121212;
    --white:#e0e0e0;
}
body {background-color: var(--dark-bg); color: var(--white); font-family:'Segoe UI',sans-serif; margin:0;padding:0;}
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin:30px; }
.assistant-card { background-color:#2a2a2a; border-radius:10px; padding:20px; border:1px solid var(--blue-royal); position: relative; }
.card-header { display:flex; align-items:center; margin-bottom:15px; }
.profile-img { width:70px;height:70px;border-radius:50%;object-fit:cover;border:2px solid var(--gold); margin-left:15px; }
.card-header h3 { color:var(--gold); margin:0; font-size:1.4em; }
.card-details p { margin:5px 0; color:#ccc; font-size:0.95em; }
.rating { color: var(--gold); margin-top:5px; }
.contact-btn, .comments-btn, .comment-submit { width:100%; padding:10px; border:none; border-radius:6px; margin-top:10px; cursor:pointer; font-weight:bold; }
.contact-btn { background-color:var(--green-success); }
.contact-btn:hover { background-color:#388e3c; }
.comments-btn { background-color:var(--blue-royal); color:#fff; }
.comments-btn:hover { background-color:#3b5b82; }
.comment-section { display:none; background:#1f1f1f; padding:10px; border-radius:6px; margin-top:10px; max-height:300px; overflow-y:auto; }
.comment-item { margin-bottom:8px; line-height:1.3em; padding-bottom:5px; border-bottom:1px dashed #444; }
.comment-name { font-weight:bold; color:var(--gold); display:block; margin-bottom:2px; }
.comment-stars { color:var(--gold); display:block; margin-bottom:2px; }
.comment-text { display:block; color:#ccc; text-align:right; }
.comment-input, .rating-select { width:100%; padding:6px; margin-top:5px; border-radius:4px; border:1px solid var(--blue-royal); background-color:#2a2a2a; color:#fff; }
.close-comments { float:left;margin-bottom:5px; background:#cf6679;color:#fff;border:none;padding:2px 6px;border-radius:4px;cursor:pointer; }
</style>
</head>
<body>
<div style="text-align:center; margin:20px;">
    <h1>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­ÙˆÙ†</h1>
    <select id="roleFilter">
        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆÙ„Ø²</option>
        <option value="GUIDE">Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ</option>
        <option value="COMPANION">Ù…Ø±Ø§ÙÙ‚</option>
        <option value="DRIVER">Ø³Ø§Ø¦Ù‚</option>
    </select>
</div>
<div id="assistantCardsGrid" class="cards-grid"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, push, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
  authDomain: "tourguideapp-313c1.firebaseapp.com",
  databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
  projectId: "tourguideapp-313c1",
  storageBucket: "tourguideapp-313c1.appspot.com",
  messagingSenderId: "1036127588385",
  appId: "1:1036127588385:web:d144dba8f70fe094395360"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø±ÙˆÙ„Ø²
const ROLES = {
    GUIDE:{key:"GUIDE",name:"Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ"},
    COMPANION:{key:"COMPANION",name:"Ù…Ø±Ø§ÙÙ‚"},
    DRIVER:{key:"DRIVER",name:"Ø³Ø§Ø¦Ù‚"}
};

// Ù…Ø«Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ© (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ù‚Ø±Ø§Ø¡Ø© Firebase)
let assistantsList = [
    {chatCode:"A001",name:"Ø£Ø­Ù…Ø¯",role:"GUIDE",experience:5,about:"Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ Ø®Ø¨ÙŠØ±",guideType:"Ø«Ù‚Ø§ÙÙŠ",groupLimit:10,price:150,img:"images/guide_man.png"},
    {chatCode:"B002",name:"Ø³Ø§Ø±Ø©",role:"COMPANION",experience:3,about:"Ù…Ø±Ø§ÙÙ‚Ø© Ø°ÙˆÙŠ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø®Ø§ØµØ©",specialization:"Ø³Ù…Ø¹ÙŠ",priceDay:100,priceHour:15,img:"images/guide_woman.png"},
    {chatCode:"C003",name:"Ù…Ø­Ù…Ø¯",role:"DRIVER",experience:7,about:"Ø³Ø§Ø¦Ù‚ Ù…Ø§Ù‡Ø±",cityPrice:50,outCityPrice:100,img:"images/driver.png"}
];

// Ø§Ù„Ù†Ø¬ÙˆÙ…
function renderStars(rating){ let stars=''; for(let i=1;i<=5;i++) stars+=i<=rating?'â­':'â˜†'; return stars; }

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ù† Firebase
async function loadCommentsFromFirebase(code){
    const snap = await get(ref(db, `assistantComments/${code}`));
    return snap.exists() ? Object.values(snap.val()) : [];
}

// Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
async function loadComments(code){
    const div=document.querySelector(`#comments-${code} .comments-list`);
    div.innerHTML='';
    const comments = await loadCommentsFromFirebase(code);
    comments.forEach(c=>{
        const el=document.createElement('div');
        el.className='comment-item';
        el.innerHTML=`<span class="comment-name">${c.name}</span><span class="comment-stars">${'â­'.repeat(c.rating)}</span><span class="comment-text">${c.text}</span>`;
        div.appendChild(el);
    });
}

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
async function submitComment(code){
    const nameInput=document.getElementById(`comment-name-${code}`);
    const textInput=document.getElementById(`comment-input-${code}`);
    const ratingSelect=document.getElementById(`comment-rating-${code}`);
    const name=nameInput.value.trim()||"Ø²Ø§Ø¦Ø±";
    const text=textInput.value.trim();
    const rating=parseInt(ratingSelect.value);
    if(!text){ alert("âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚"); return; }
    const commentData={name,text,rating};
    const newRef = push(ref(db, `assistantComments/${code}`));
    await set(newRef, commentData);
    nameInput.value=''; textInput.value=''; ratingSelect.value='5';
    await loadComments(code);
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ø¨Ù†Ø¬Ø§Ø­");
}

// Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
function toggleComments(code){
    const sec=document.getElementById(`comments-${code}`);
    sec.style.display=sec.style.display==='block'?'none':'block';
}

// Ø²Ø± Ø§Ù„Ø´Ø§Øª
function startChat(code,name){
    window.location.href=`chat_page.html?code=${code}&name=${encodeURIComponent(name)}`;
}

// ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
async function renderCards(list){
    const grid = document.getElementById('assistantCardsGrid');
    grid.innerHTML='';
    if(list.length===0){ grid.innerHTML='<p style="text-align:center;color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³Ø§Ø¹Ø¯ÙˆÙ†</p>'; return; }
    for(const a of list){
        const card=document.createElement('div'); card.className='assistant-card';
        card.innerHTML=`
            <div class="card-header">
                <img src="${a.img}" class="profile-img">
                <div><h3>${a.name}</h3><div class="rating">${renderStars(5)} (${a.experience} Ø³Ù†Ø© Ø®Ø¨Ø±Ø©)</div></div>
            </div>
            <div class="card-details">
                ${a.role==='GUIDE'?`<p><strong>ØªØ®ØµØµ:</strong> ${a.guideType}</p><p><strong>Ø­Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</strong> ${a.groupLimit}</p><p><strong>Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…:</strong> ${a.price} Ø¯Ø±Ù‡Ù…</p>`: ''}
                ${a.role==='COMPANION'?`<p><strong>ØªØ®ØµØµ:</strong> ${a.specialization}</p><p><strong>Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…:</strong> ${a.priceDay}</p><p><strong>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø©:</strong> ${a.priceHour}</p>`: ''}
                ${a.role==='DRIVER'?`<p><strong>Ø£Ø¬Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${a.cityPrice}</p><p><strong>Ø£Ø¬Ø±Ø© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${a.outCityPrice}</p>`: ''}
                <p><strong>Ù†Ø¨Ø°Ø©:</strong> ${a.about}</p>
            </div>
            <button class="contact-btn" onclick="startChat('${a.chatCode}','${a.name}')">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¢Ù†</button>
            <button class="comments-btn" onclick="toggleComments('${a.chatCode}')">ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</button>
            <div class="comment-section" id="comments-${a.chatCode}">
                <button class="close-comments" onclick="toggleComments('${a.chatCode}')">âœ–</button>
                <div class="comments-list"></div>
                <input type="text" placeholder="Ø§Ø³Ù…Ùƒ..." class="comment-input" id="comment-name-${a.chatCode}">
                <input type="text" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚..." class="comment-input" id="comment-input-${a.chatCode}">
                <select class="rating-select" id="comment-rating-${a.chatCode}">
                    <option value="1">â­1</option><option value="2">â­2</option>
                    <option value="3">â­3</option><option value="4">â­4</option>
                    <option value="5" selected>â­5</option>
                </select>
                <button class="comment-submit" onclick="submitComment('${a.chatCode}')">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</button>
            </div>
        `;
        grid.appendChild(card);
        await loadComments(a.chatCode);
    }
}

// ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
document.getElementById('roleFilter').addEventListener('change', async function(){
    const val=this.value;
    const filtered = val ? assistantsList.filter(a=>a.role===val) : assistantsList;
    await renderCards(filtered);
});

// Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
document.addEventListener('DOMContentLoaded', async ()=>{
    await renderCards(assistantsList);
});
</script>
</body>
</html>
